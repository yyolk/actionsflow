on:
  rss:
    url: https://status.taskade.com/history.rss
    force: true
jobs:
  # rough copy, feasability check
  print_and_pushover_notify:
    name: Print and Pushover Notify
    runs-on: ubuntu-latest
    steps:
      - name: Print Outputs
        env:
          title: ${{on.rss.outputs.title}}
          contentSnippet: ${{on.rss.outputs.contentSnippet}}
          link: ${{on.rss.outputs.link}}
        run: |
          echo title: $title
          echo contentSnippet: $contentSnippet
          echo link: $link
      - name: Pushover Notify
        env:
          PUSHOVER_API_TOKEN: ${{ secrets.PUSHOVER_API_TOKEN }}
          PUSHOVER_USER_KEY: ${{ secrets.PUSHOVER_USER_KEY }}
          title: ${{on.rss.outputs.title}}
          content: ${{on.rss.outputs.content}}
          link: ${{on.rss.outputs.link}}
        run: >-
          curl -s
          -X POST
          -H "Content-Type: application/json"
          -d '{
            "token": "$PUSHOVER_API_TOKEN",
            "user": "$PUSHOVER_USER_KEY",
            "title": "Taskade Status: $title",
            "message": "$content",
            "html": 1,
            "url": "$link",
            "url_title": "Read more..."
          }'
          https://api.pushover.net/1/messages.json
